pool:
  vmImage: 'windows-latest'

steps:
- template: build.yml
  parameters:
    additionalPackOptions: '/p:PublicRelease=false'
    runTests: false

- task: NuGetAuthenticate@0
  displayName: Authenticate with NuGet feeds

- task: NuGetCommand@2
  inputs:
    command: push
    packagesToPush: $(Build.SourcesDirectory)/bin/Release/Packages/*.nupkg
    nuGetFeedType: internal
    publishVstsFeed: coverlet/coverlet-nightly
  displayName: Publish NuGet packages

- task: NuGetCommand@2
  inputs:
    command: push
    packagesToPush: $(Build.SourcesDirectory)/bin/Release/Packages/*.snupkg
    nuGetFeedType: internal
    publishVstsFeed: coverlet/coverlet-nightly
  displayName: Publish NuGet symbol packages
