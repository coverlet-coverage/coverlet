steps:
- task: CopyFiles@2
  displayName: Copy test results
  continueOnError: true
  condition: always()
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)/artifacts'
    Contents: |
      **/*.trx
      **/*.html
      **/*.opencover.xml
      **/*.cobertura.xml
      **/*.coverage.json
      **/log.txt
      **/log.datacollector.*.txt
      **/log.host.*.txt
      **/coverlet.MTP.unit.tests/**/*.diag
      **/coverlet.MTP.unit.tests/**/*.log
      **/coverlet.MTP.validation.tests/**/*.diag
      **/coverlet.MTP.validation.tests/**/*.log
      **/coverlet.core.coverage.tests/**/*.diag
      **/coverlet.core.coverage.tests/**/*.log
      **/coverlet.core.tests/**/*.diag
      **/coverlet.core.tests/**/*.log
      **/*.diag
    TargetFolder: '$(Build.SourcesDirectory)/artifacts/TestLogs'

- task: CopyFiles@2
  displayName: Copy trx files
  condition: always()
  inputs:
    SourceFolder: '$(Agent.TempDirectory)'
    Contents: |
        **/*.trx
        **/coverage.opencover.xml
        **/coverage.cobertura.xml
        **/coverage.json
    TargetFolder: '$(Build.SourcesDirectory)/artifacts/TestLogs'

- task: CopyFiles@2
  displayName: Copy binlog files
  condition: always()
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)'
    Contents: '*.binlog'
    TargetFolder: '$(Build.SourcesDirectory)/artifacts/TestLogs'

- task: CopyFiles@2
  displayName: Copy DeterministicBuild binlog files
  condition: always()
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)'
    Contents: 'test\coverlet.integration.determisticbuild\*.binlog'
    TargetFolder: '$(Build.SourcesDirectory)/artifacts/TestLogs'

- task: PublishPipelineArtifact@1
  displayName: Publish Coverlet logs
  continueOnError: true
  condition: always()
  inputs:
    path: artifacts/TestLogs
    artifactName: TestLogs_$(Agent.Os)_$(BuildConfiguration)
